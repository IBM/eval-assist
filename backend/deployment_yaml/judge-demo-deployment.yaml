apiVersion: apps/v1
kind: Deployment
metadata:
  name: llm-judge-demo-ui
  labels:
    app: llm-judge-demo-ui
spec:
  selector:
    matchLabels:
      run: llm-judge-demo-ui
  replicas: 1
  template:
    metadata:
      labels:
        run: llm-judge-demo-ui
    spec:
      containers:
        - name: llm-judge-demo-ui-container
          image: us.icr.io/research3/llm-judge-demo-ui
          resources:
            limits:
              cpu: 2
              memory: 2Gi
            requests:
              cpu: 2
              memory: 2Gi
          ports:
            - containerPort: 3000
          env:
            - name: NEXT_PUBLIC_BACKEND_API_HOST
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: NEXT_PUBLIC_BACKEND_API_HOST
            - name: NEXTAUTH_SECRET
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: NEXTAUTH_SECRET
            - name: NEXTAUTH_URL
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: NEXTAUTH_URL
            - name: AUTH_PROVIDER_ID
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: AUTH_PROVIDER_ID
            - name: AUTH_PROVIDER_NAME
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: AUTH_PROVIDER_NAME
            - name: AUTH_WELL_KNOWN
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: AUTH_WELL_KNOWN
            - name: AUTH_CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: AUTH_CLIENT_ID
            - name: AUTH_CLIENT_SECRET
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: AUTH_CLIENT_SECRET
      imagePullSecrets:
        - name: all-icr-io
---
apiVersion: v1
kind: Service
metadata:
  name: llm-judge-demo-ui-service
spec:
  type: NodePort
  selector:
    run: llm-judge-demo-ui
  ports:
    - port: 80
      targetPort: 3000
      protocol: TCP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: llm-judge-demo-api
  labels:
    app: llm-judge-demo-api
spec:
  selector:
    matchLabels:
      run: llm-judge-demo-api
  replicas: 1
  template:
    metadata:
      labels:
        run: llm-judge-demo-api
    spec:
      containers:
        - name: llm-judge-demo-api-container
          image: IMAus.icr.io/research3/llm-judge-demo-apiGE_NAME
          resources:
            limits:
              cpu: 2
              memory: 2Gi
            requests:
              cpu: 2
              memory: 2Gi
          ports:
            - containerPort: 8000
          env:
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: DATABASE_URL
            - name: GENAI_KEY
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: GENAI_KEY
            - name: GENAI_API
              valueFrom:
                secretKeyRef:
                  name: llm-judge-secrets
                  key: GENAI_API
      imagePullSecrets:
        - name: all-icr-io
---
apiVersion: v1
kind: Service
metadata:
  name: llm-judge-demo-api-service
spec:
  type: NodePort
  selector:
    run: llm-judge-demo-api
  ports:
    - port: 80
      targetPort: 8000
      protocol: TCP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    ingress.kubernetes.io/allow-http: 'false'
    ingress.kubernetes.io/ssl-redirect: 'true'
    kubernetes.io/ingress.class: f5
    virtual-server.f5.com/balance: round-robin
    virtual-server.f5.com/ip: 9.12.246.103
    virtual-server.f5.com/partition: RIS3-INT-OCP-DAL12
    virtual-server.f5.com/clientssl: '[ { "bigIpProfile": "/Common/BlueMix" } ]'
  name: llm-judge-demo-bundled-ingress
  namespace: llm-judge-demo
spec:
  rules:
  - host: llm-judge-demo.bx.cloud9.ibm.com
    http:
      paths:
      - backend:
          service:
            name: llm-judge-demo-ui-service
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
  - host: llm-judge-demo-api.bx.cloud9.ibm.com
    http:
      paths:
      - backend:
          service:
            name: llm-judge-demo-api-service
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
